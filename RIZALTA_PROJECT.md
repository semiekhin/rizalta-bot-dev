# RIZALTA BOT ‚Äî –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

> **–î–ª—è Claude:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç "–æ–±–Ω–æ–≤–∏ —Ç–µ–∫—É—â—É—é –∑–∞–¥–∞—á—É –¥–ª—è –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞" ‚Äî –æ–±–Ω–æ–≤–∏ —Ñ–∞–π–ª `RIZALTA_CURRENT_TASK.md` —Å –∏—Ç–æ–≥–∞–º–∏ —Ä–∞–±–æ—Ç—ã, —Ç–µ–∫—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ —Å–ª–µ–¥—É—é—â–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏, –∑–∞—Ç–µ–º –¥–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ GitHub.

---

## üéØ –ß—Ç–æ —ç—Ç–æ –∑–∞ –±–æ—Ç

AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –¥–ª—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ **RIZALTA Resort Belokurikha** (–ë–µ–ª–æ–∫—É—Ä–∏—Ö–∞, –ê–ª—Ç–∞–π).

**Telegram:** @rizaboris_bot

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

- ü§ñ AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –Ω–∞ GPT-4o-mini —Å Function Calling
- üìã –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (–ö–ü) ‚Äî –ø–æ–∏—Å–∫ –ø–æ –ø–ª–æ—â–∞–¥–∏/–±—é–¥–∂–µ—Ç—É, –æ—Ç–ø—Ä–∞–≤–∫–∞ JPG
- üí∞ –†–∞—Å—á—ë—Ç –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏ –∏ ROI –ø–æ –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–∞–º
- üí≥ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Å—Å—Ä–æ—á–∫–∏ –∏ –∏–ø–æ—Ç–µ–∫–∏
- üìä –ü–æ–¥–±–æ—Ä –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–≥–æ –ø–æ—Ä—Ç—Ñ–µ–ª—è –ø–æ–¥ –±—é–¥–∂–µ—Ç
- üî• –ó–∞–ø–∏—Å—å –Ω–∞ –æ–Ω–ª–∞–π–Ω-–ø–æ–∫–∞–∑
- üìß Email –∏ Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º
- üìé –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫ (PDF)

---

## üñ• –°–µ—Ä–≤–µ—Ä

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| IP | `72.56.64.91` |
| OS | Ubuntu 24 |
| –ü—É—Ç—å –∫ –±–æ—Ç—É | `/opt/bot/` |
| –ü–æ—Ä—Ç | 8000 |
| Python | 3.10+ (venv) |

### SSH –¥–æ—Å—Ç—É–ø:
```bash
ssh root@72.56.64.91
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/opt/bot/
‚îú‚îÄ‚îÄ app.py                    # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª (FastAPI + webhook)
‚îú‚îÄ‚îÄ .env                      # –°–µ–∫—Ä–µ—Ç—ã (–ù–ï –≤ git!)
‚îú‚îÄ‚îÄ .env.example              # –®–∞–±–ª–æ–Ω —Å–µ–∫—Ä–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ properties.db             # SQLite –±–∞–∑–∞ (375 –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤)
‚îú‚îÄ‚îÄ requirements.txt          # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ settings.py           # –ù–∞—Å—Ç—Ä–æ–π–∫–∏, –ø—É—Ç–∏, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ instructions.txt      # –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è AI
‚îÇ
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ ai_chat.py            # AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç + Function Calling
‚îÇ   ‚îú‚îÄ‚îÄ booking.py            # –ó–∞–ø–∏—Å—å –Ω–∞ –ø–æ–∫–∞–∑
‚îÇ   ‚îú‚îÄ‚îÄ kp.py                 # –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (NEW!)
‚îÇ   ‚îú‚îÄ‚îÄ menu.py               # –ú–µ–Ω—é –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ units.py              # –†–∞—Å—á—ë—Ç—ã ROI, —Ä–∞—Å—Å—Ä–æ—á–∫–∞
‚îÇ
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ ai_chat.py            # OpenAI –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ calculations.py       # –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–∞—Å—á—ë—Ç—ã (1195 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ data_loader.py        # –ó–∞–≥—Ä—É–∑–∫–∞ JSON/TXT
‚îÇ   ‚îú‚îÄ‚îÄ kp_search.py          # –ü–æ–∏—Å–∫ –ö–ü —Ñ–∞–π–ª–æ–≤ (NEW!)
‚îÇ   ‚îú‚îÄ‚îÄ notifications.py      # Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ telegram.py           # Telegram API (send_photo, send_media_group)
‚îÇ
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ state.py              # –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ rizalta_finance.json  # –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ units.json            # 3 –±–∞–∑–æ–≤—ã—Ö —é–Ω–∏—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ rizalta_knowledge_base.txt
‚îÇ   ‚îú‚îÄ‚îÄ text_why_rizalta.md
‚îÇ   ‚îú‚îÄ‚îÄ text_why_belokuricha.md
‚îÇ   ‚îú‚îÄ‚îÄ text_architect.md
‚îÇ   ‚îî‚îÄ‚îÄ layouts/              # PDF –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
‚îÇ
‚îú‚îÄ‚îÄ kp_all/                   # 69 JPG –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ kp_24.5m_business_–ê209.jpg
‚îÇ   ‚îú‚îÄ‚îÄ kp_113.3m_family_–í904.jpg
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ docs/                     # –î–æ–∫—É–º–µ–Ω—Ç—ã (66 MB)
‚îú‚îÄ‚îÄ kp_generator.py           # –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä HTML‚ÜíJPG –ö–ü
‚îî‚îÄ‚îÄ header_image_base64.txt   # –ö–∞—Ä—Ç–∏–Ω–∫–∞ –¥–ª—è —à–∞–ø–∫–∏ –ö–ü
```

---

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
# Telegram
TELEGRAM_BOT_TOKEN=8343378629:AAHHacgXmIVhShhtPtdEooKEkV34ZD1t59s

# OpenAI
OPENAI_API_KEY=sk-proj-...
OPENAI_MODEL=gpt-4o-mini
OPENAI_MAX_TOKENS=800

# Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
MANAGER_EMAIL=89181011091s@mail.ru,dreaming2015@mail.ru
BOT_EMAIL=rizalta-bot@mail.ru
SMTP_HOST=smtp.mail.ru
SMTP_PORT=587
SMTP_USER=rizalta-bot@mail.ru
SMTP_PASSWORD=...
```

**–í–ê–ñ–ù–û:** `.env` –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ git! –¢–æ–ª—å–∫–æ `.env.example` –∫–∞–∫ —à–∞–±–ª–æ–Ω.

---

## üöÄ –ó–∞–ø—É—Å–∫ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:
```bash
ps aux | grep "python app.py"
```

### –ó–∞–ø—É—Å—Ç–∏—Ç—å:
```bash
cd /opt/bot
source venv/bin/activate
nohup python app.py > bot.log 2>&1 &
```

### –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
```bash
pkill -f "python app.py"
# –∏–ª–∏ –µ—Å–ª–∏ –ø–æ—Ä—Ç –∑–∞–Ω—è—Ç:
fuser -k 8000/tcp
```

### –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:
```bash
tail -50 /opt/bot/bot.log
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å:
```bash
cd /opt/bot
pkill -f "python app.py"
sleep 2
source venv/bin/activate
nohup python app.py > bot.log 2>&1 &
```

---

## üì¶ –î–µ–ø–ª–æ–π –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏

### 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—Ä—Ö–∏–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
```bash
scp rizalta_vX.X.tar.gz root@72.56.64.91:/tmp/
```

### 2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:
```bash
cd /opt/bot

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
pkill -f "python app.py"

# –ë—ç–∫–∞–ø (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
tar -czvf /tmp/backup_$(date +%Y%m%d).tar.gz --exclude='venv' --exclude='kp_all' --exclude='docs' .

# –†–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å (–±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∏ .env)
tar -xzf /tmp/rizalta_vX.X.tar.gz --exclude='.env'

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
source venv/bin/activate
nohup python app.py > bot.log 2>&1 &
```

---

## üóÑ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

**–§–∞–π–ª:** `/opt/bot/properties.db` (SQLite)

**–¢–∞–±–ª–∏—Ü–∞ `units`:**
- 375 –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç–æ–≤
- 2 –±–ª–æ–∫-—Å–µ–∫—Ü–∏–∏ (–∫–æ—Ä–ø—É—Å 1 = B, –∫–æ—Ä–ø—É—Å 2 = A)

**–ü–æ–ª—è:**
- `code` ‚Äî –∫–æ–¥ –ª–æ—Ç–∞ (–ê209, –í415)
- `area_m2` ‚Äî –ø–ª–æ—â–∞–¥—å
- `price_rub` ‚Äî —Ü–µ–Ω–∞
- `floor` ‚Äî —ç—Ç–∞–∂
- `block_section` ‚Äî –∫–æ—Ä–ø—É—Å (1 –∏–ª–∏ 2)

### –ü–æ–ª–µ–∑–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
```bash
cd /opt/bot
sqlite3 properties.db "SELECT COUNT(*) FROM units;"
sqlite3 properties.db "SELECT * FROM units LIMIT 5;"
sqlite3 properties.db "SELECT code, area_m2, price_rub FROM units WHERE area_m2 BETWEEN 22 AND 25;"
```

---

## üìã –§–∏—á–∞: –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (–ö–ü)

### UX Flow:

```
üìã –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
    ‚Üì
‚îú‚îÄ‚îÄ üìê –ü–æ –ø–ª–æ—â–∞–¥–∏
‚îÇ   ‚îú‚îÄ‚îÄ 22-25 –º¬≤ | 26-30 –º¬≤ | 31-35 –º¬≤
‚îÇ   ‚îî‚îÄ‚îÄ 36-40 –º¬≤ | 41-45 –º¬≤ | 46+ –º¬≤
‚îÇ       ‚Üì
‚îÇ   [–ê101 ‚Äî 24.4 –º¬≤ ‚Äî 15.2 –º–ª–Ω]  ‚Üê –∫–Ω–æ–ø–∫–∞
‚îÇ   [–ê209 ‚Äî 24.5 –º¬≤ ‚Äî 15.3 –º–ª–Ω]  ‚Üê –∫–Ω–æ–ø–∫–∞
‚îÇ   [üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ (4 —à—Ç.)]
‚îÇ
‚îî‚îÄ‚îÄ üí∞ –ü–æ –±—é–¥–∂–µ—Ç—É
    ‚îú‚îÄ‚îÄ –¥–æ 15 –º–ª–Ω | 15-18 –º–ª–Ω | 18-22 –º–ª–Ω
    ‚îî‚îÄ‚îÄ 22-26 –º–ª–Ω | 26-30 –º–ª–Ω | 30+ –º–ª–Ω
```

### –§–∞–π–ª—ã:
- `handlers/kp.py` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
- `services/kp_search.py` ‚Äî –ø–æ–∏—Å–∫ JPG
- `services/telegram.py` ‚Äî `send_photo()`, `send_media_group()`

### JPG —Ñ–∞–π–ª—ã:
```
/opt/bot/kp_all/
‚îú‚îÄ‚îÄ kp_24.5m_business_–ê209.jpg
‚îú‚îÄ‚îÄ kp_113.3m_family_–í904.jpg
‚îî‚îÄ‚îÄ ... (69 —Ñ–∞–π–ª–æ–≤)
```

–ü–∞—Ç—Ç–µ—Ä–Ω –∏–º–µ–Ω–∏: `kp_{–ø–ª–æ—â–∞–¥—å}m_{—Ç–∏–ø}_{–∫–æ–¥}.jpg`

---

## üîß AI Function Calling

**–§–∞–π–ª:** `services/ai_chat.py`

**–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `build_portfolio` ‚Äî –ø–æ–¥–±–æ—Ä –ø–æ—Ä—Ç—Ñ–µ–ª—è –ø–æ–¥ –±—é–¥–∂–µ—Ç
- `calculate_roi` ‚Äî —Ä–∞—Å—á—ë—Ç –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏
- `show_installment` ‚Äî —Ä–∞—Å—Å—Ä–æ—á–∫–∞/–∏–ø–æ—Ç–µ–∫–∞
- `book_showing` ‚Äî –∑–∞–ø–∏—Å—å –Ω–∞ –ø–æ–∫–∞–∑
- `show_layouts` ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏
- `get_commercial_proposal` ‚Äî –ö–ü (NEW!)

---

## üìÇ –ê—Ä—Ö–∏–≤—ã (–≤–µ—Ä—Å–∏–∏)

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `rizalta_v1.0_stable.tar.gz` | –†–∞–±–æ—á–∞—è –≤–µ—Ä—Å–∏—è –±–µ–∑ –ö–ü |
| `rizalta_v1.1_with_kp.tar.gz` | + –ö–ü —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥ |
| `rizalta_v1.2_kp_buttons.tar.gz` | + –ö–ü —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏ (—Ç–µ–∫—É—â–∞—è) |
| `rizalta_v1.0_media.tar.gz` | JPG + docs (77 MB) |

---

## üîó –°—Å—ã–ª–∫–∏

- **GitHub:** https://github.com/semiekhin/rizalta-bot
- **–°–µ—Ä–≤–µ—Ä:** 72.56.64.91
- **Telegram Bot:** @rizaboris_bot

---

## üìù –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### v1.2 (04.12.2024)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ–∏—á–∞ –ö–ü —Å –∫–Ω–æ–ø–∫–∞–º–∏ (–ø–æ –ø–ª–æ—â–∞–¥–∏ / –ø–æ –±—é–¥–∂–µ—Ç—É)
- Inline-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ª–æ—Ç–∞
- –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ" –¥–ª—è –∞–ª—å–±–æ–º–∞

### v1.1 (04.12.2024)
- –ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è –ö–ü —á–µ—Ä–µ–∑ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥
- –î–æ–±–∞–≤–ª–µ–Ω—ã `send_photo()`, `send_media_group()`

### v1.0 (–Ω–æ—è–±—Ä—å 2024)
- –ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª: AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç, ROI, —Ä–∞—Å—Å—Ä–æ—á–∫–∞, –∑–∞–ø–∏—Å—å –Ω–∞ –ø–æ–∫–∞–∑
